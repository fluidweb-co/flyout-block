{"version":3,"file":"../flyout-block.min.js","sources":["flyout-block.js"],"sourcesContent":["/**\n * Manage states and views for the flyout blocks.\n * \n * File flyout-block.js.\n */\n(function (root, factory) {\n\tif ( typeof define === 'function' && define.amd ) {\n\t\tdefine([], factory(root));\n\t} else if ( typeof exports === 'object' ) {\n\t\tmodule.exports = factory(root);\n\t} else {\n\t\troot.FlyoutBlock = factory(root);\n\t}\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\n\n\t'use strict';\n\n\tvar _hasInitialized = false;\n\tvar _publicMethods = {\n\t\tmanagers: [],\n\t};\n\tvar _settings = { };\n\tvar _defaults = {\n\t\tflyoutWrapperSelector: '[data-flyout]',\n\t\tflyoutContentSelector: '[data-flyout-content]',\n\t\ttoggleButtonSelector: '[data-flyout-toggle]',\n\t\topenButtonSelector: '[data-flyout-open]',\n\t\tcloseButtonSelector: '[data-flyout-close]',\n\t\toverlaySelector: '[data-flyout-overlay]',\n\t\tflyoutTogglePassActionSelector: '[data-flyout-pass-action], .js-flyout-pass-action',\n\t\tautoFocusSelector: '[data-autofocus]',\n\n\t\tflyoutToggleClassSelector: '.js-flyout-toggle',\n\t\tflyoutClassTogglePrefix: 'js-flyout-target-',\n\t\t\n\t\tidPrefix: 'flyout-block',\n\t\theadingsSelector: 'h1, h2, h3, h4, h5, h6, [role=\"heading\"]',\n\t\t\n\t\tbodyHasFlyoutClass: 'has-flyout',\n\t\tbodyHasFlyoutOpenClass: 'has-flyout--open',\n\t\tisActivatedClass: 'is-activated',\n\t\tisOpenClass: 'is-open',\n\t\topenAnimationClass: 'fade-in-up',\n\t\tcloseAnimationClass: 'fade-out-down',\n\t\t\n\t\ttargetElementAttribute: 'data-flyout-target',\n\t\topenAnimationClassAttribute: 'data-flyout-open-animation-class',\n\t\tcloseAnimationClassAttribute: 'data-flyout-close-animation-class',\n\t\tmanualFocusAttribute: 'data-flyout-manual-focus',\n\t\tdescriptionAttribute: 'data-flyout-description',\n\t\tautoFocusAttribute: 'data-autofocus',\n\t\tfocusableElementsSelector: 'a[href], button:not([disabled]), input:not([disabled]):not([type=\"hidden\"]), textarea:not([disabled]), select:not([disabled]), details, summary, iframe, object, embed, [contenteditable] [tabindex]:not([tabindex=\"-1\"])',\n\t\t\n\t\tflyoutRoleAttribute: 'data-flyout-role',\n\n\t\toverlayTemplate: '<div class=\"flyout-overlay\" data-flyout-overlay></div>',\n\t};\n\tvar _states = {\n\t\tOPEN: 'open',\n\t\tCLOSED: 'closed',\n\t}\n\tvar _key = {\n\t\tTAB: 'Tab',\n\t\tENTER: 'Enter',\n\t\tESC: 'Escape',\n\t\tSPACE: ' ',\n\t}\n\n\n\n\t/*!\n\t* Merge two or more objects together.\n\t* (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com\n\t* @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]\n\t* @param   {Object}   objects  The objects to merge together\n\t* @returns {Object}            Merged values of defaults and options\n\t*/\n\tvar extend = function () {\n\t\t// Variables\n\t\tvar extended = {};\n\t\tvar deep = false;\n\t\tvar i = 0;\n\n\t\t// Check if a deep merge\n\t\tif ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {\n\t\t\tdeep = arguments[0];\n\t\t\ti++;\n\t\t}\n\n\t\t// Merge the object into the extended object\n\t\tvar merge = function (obj) {\n\t\t\tfor (var prop in obj) {\n\t\t\t\tif (obj.hasOwnProperty(prop)) {\n\t\t\t\t\t// If property is an object, merge properties\n\t\t\t\t\tif (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n\t\t\t\t\t\textended[prop] = extend(extended[prop], obj[prop]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\textended[prop] = obj[prop];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Loop through each object and conduct a merge\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar obj = arguments[i];\n\t\t\tmerge(obj);\n\t\t}\n\n\t\treturn extended;\n\t};\n\n\n\t/**\n\t * Gets keyboard-focusable elements within a specified element\n\t *\n\t * @param   HTMLElement  element  The element to search within. Defaults to the `document` root element.\n\t *\n\t * @return  NodeList              All focusable elements withing the element passed in.\n\t */\n\tvar getFocusableElements = function( element ) {\n\t\t// Set element to `document` root if not passed in\n\t\tif ( ! element ) { element = document; }\n\t\t\n\t\t// Get elements that are keyboard-focusable, but might be `disabled`\n\t\treturn element.querySelectorAll( _settings.focusableElementsSelector );\n\t}\n\n\n\n\t/**\n\t * Get target element\n\t */\n\tvar getTargetElement = function( element ) {\n\t\t// Bail if element not valid\n\t\tif ( ! element ) return false;\n\n\t\t// Try get target element from attributes\n\t\tvar targetSelector = element.getAttribute( _settings.targetElementAttribute );\n\t\tif ( targetSelector && targetSelector != '' ) {\n\t\t\treturn document.querySelector( targetSelector );\n\t\t}\n\n\t\t// Return target element from parent nodes\n\t\treturn element.closest( _settings.flyoutWrapperSelector );\n\t}\n\n\n\n\t/**\n\t * Get target element\n\t */\n\tvar getTargetElementFromClass = function( element ) {\n\t\tif ( ! element ) { return false; }\n\n\t\t// Iterate classes\n\t\tfor ( var i = 0; i < element.classList.length; i++ ) {\n\t\t\tvar cssClass = element.classList[i];\n\t\t\tif ( cssClass.indexOf( _settings.flyoutClassTogglePrefix ) == 0 ) {\n\t\t\t\t// Get target id from class name\n\t\t\t\tvar targetSelector = '#' + cssClass.replace( _settings.flyoutClassTogglePrefix, '' );\n\t\t\t\treturn document.querySelector( targetSelector );\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn false;\n\t}\n\n\n\t/**\n\t * Handle document clicks and route to the appropriate function.\n\t */\n\tvar handleClick = function ( e ) {\n\t\t// TOGGLE\n\t\tif ( e.target.closest( _settings.toggleButtonSelector ) ) {\n\t\t\te.preventDefault();\n\t\t\tvar button = e.target.closest( _settings.toggleButtonSelector );\n\t\t\tvar element = getTargetElement( button );\n\t\t\t_publicMethods.toggle( element );\n\t\t}\n\t\t// TOGGLE (CSS CLASS)\n\t\telse if ( e.target.closest( _settings.flyoutToggleClassSelector ) ) {\n\t\t\t// Maybe prevent element's action\n\t\t\tif ( ! e.target.closest( _settings.flyoutTogglePassActionSelector ) ) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\tvar toggleElement = e.target.closest( _settings.flyoutToggleClassSelector );\n\t\t\tvar element = getTargetElementFromClass( toggleElement );\n\t\t\t\n\t\t\tif ( element ) {\n\t\t\t\t_publicMethods.toggle( element );\n\t\t\t}\n\t\t}\n\t\t// OPEN\n\t\telse if ( e.target.closest( _settings.openButtonSelector ) ) {\n\t\t\te.preventDefault();\n\t\t\tvar button = e.target.closest( _settings.openButtonSelector );\n\t\t\tvar element = getTargetElement( button );\n\t\t\t_publicMethods.open( element );\n\t\t}\n\t\t// CLOSE\n\t\telse if ( e.target.closest( _settings.closeButtonSelector ) ) {\n\t\t\te.preventDefault();\n\t\t\t\n\t\t\tvar button = e.target.closest( _settings.closeButtonSelector );\n\t\t\tvar element = getTargetElement( button );\n\t\t\t_publicMethods.close( element );\n\t\t}\n\t\t// OVERLAY - Specific to a flyout block\n\t\telse if ( e.target.matches( _settings.flyoutWrapperSelector ) ) {\n\t\t\tvar element = getTargetElement( e.target );\n\t\t\t_publicMethods.close( element );\n\t\t}\n\t\t// OVERLAY - General\n\t\telse if ( e.target.closest( _settings.overlaySelector ) ) {\n\t\t\t_publicMethods.closeAll();\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Handle keypress event.\n\t */\n\tvar handleKeyDown = function( e ) {\n\t\t// Should do nothing if the default action has been cancelled\n\t\tif ( e.defaultPrevented ) { return; }\n\n\t\t// Close all flyout blocks if `ESC` was pressed\n\t\tif ( e.key == _key.ESC ) {\n\t\t\t_publicMethods.closeAll();\n\t\t}\n\n\t\t// ENTER on flyout trigger\n\t\tif ( ( e.key == _key.ENTER || e.key == _key.SPACE ) && e.target.closest( _settings.triggerSelectors ) ) {\n\t\t\t// Similate click\n\t\t\thandleClick( e );\n\t\t}\n\t};\n\n\n\n\t/**\n\t * Set the `inert` property of the sibling elements.\n\t *\n\t * @param   HTMLElement  element  The element which to maintain the focus in, all siblings will be marked with the value of the param `inert` except this one.\n\t * @param   bool         inert    Boolean value to set to the `inert` property, `true` will make siblings inert, `false` will release the inert state.\n\t */\n\tvar setSiblingsInert = function( element, inert ) {\n\t\t// Bail if element does not have a parentNode\n\t\tif ( ! element || ! element.parentNode ) { return; }\n\n\t\t// Release all elements in case of an invalid value for the `inert` param.\n\t\tif ( typeof inert !== 'boolean' ) { inert = false; }\n\n\t\t// Make all other elements `inert`\n\t\tvar siblings = element.parentNode ? element.parentNode.childNodes : null;\n\t\tif ( siblings ) {\n\t\t\tArray.from( siblings ).forEach( function( child ) {\n\t\t\t\tif ( child != element ) { child.inert = inert; }\n\t\t\t} );\n\t\t}\n\t}\n\n\n\t/**\n\t * Set all sibling elements on the passed element's tree with `inert` property.\n\t *\n\t * @param   HTMLElement  element  The element which to maintain the focus in, all siblings up the element's tree will be marked with the value of the param `inert` except this one.\n\t * @param   bool         inert    Boolean value to set to the `inert` property, `true` will make siblings inert, `false` will release the inert state.\n\t */\n\tvar setTreeSiblingsInert = function( element, inert ) {\n\t\t// Bail if element does not have a parentNode\n\t\tif ( ! element || ! element.parentNode ) { return; }\n\n\t\tvar targetElement = element;\n\t\t\n\t\twhile ( targetElement.parentNode ) {\n\t\t\tsetSiblingsInert( targetElement, inert );\n\t\t\ttargetElement = targetElement.parentNode;\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Get current state of element\n\t */\n\t_publicMethods.getState = function ( element ) {\n\t\tvar manager = _publicMethods.getInstance( element );\n\t\t// Bail if manager invalid\n\t\tif ( ! manager ) return false;\n\n\t\treturn manager.state;\n\t}\n\n\n\n\t/**\n\t * Open element\n\t */\n\t_publicMethods.open = function ( element ) {\n\t\tvar manager = _publicMethods.getInstance( element );\n\t\t// Bail if manager invalid\n\t\tif ( ! manager ) return false;\n\n\t\t// Save element with focus\n\t\tmanager.previousActiveElement = document.activeElement;\n\n\t\t// Set element open then play openning animation\n\t\tAnimateHelper.doThenAnimate( element, manager.settings.openAnimationClass, function() {\n\t\t\t// Set manager state\n\t\t\tmanager.state = _states.OPEN;\n\n\t\t\t// Maybe save `hidden` attribute on the flyout element\n\t\t\tmanager.wasHidden = manager.element.hasAttribute( 'hidden' );\n\t\t\tmanager.element.removeAttribute( 'hidden' );\n\n\t\t\t// Set classes\n\t\t\tmanager.element.classList.add( manager.settings.isOpenClass );\n\t\t\tdocument.body.classList.add( manager.settings.bodyHasFlyoutOpenClass, manager.settings.bodyHasFlyoutOpenClass + '-' + manager.element.id );\n\n\t\t\t// Set flyout content `role` attribute from data attributes\n\t\t\tvar roleAttrValue = manager.element.getAttribute( manager.settings.flyoutRoleAttribute ) == 'alert' || manager.element.getAttribute( manager.settings.flyoutRoleAttribute ) == 'alertdialog' ? 'alertdialog' : 'dialog';\n\t\t\tmanager.contentElement.setAttribute( 'role', roleAttrValue );\n\n\t\t\t// Set content element as focusable\n\t\t\tmanager.contentElement.setAttribute( 'tabindex', 0 );\n\n\t\t\t// Maybe skip setting focus\n\t\t\tif ( ! manager.element.hasAttribute( manager.settings.manualFocusAttribute ) ) {\n\t\t\t\t// Set focus element as the dialog itself\n\t\t\t\tvar focusElement = manager.contentElement;\n\t\t\t\t\n\t\t\t\t// Maybe set focus to child element marked as auto-focus\n\t\t\t\tvar autofocusChild = manager.element.querySelector( manager.settings.autoFocusSelector );\n\t\t\t\tif ( autofocusChild ) {\n\t\t\t\t\tfocusElement = autofocusChild;\n\t\t\t\t}\n\t\t\t\t// Maybe set focus to first focusable element\n\t\t\t\telse if ( manager.element.matches( manager.settings.autoFocusSelector ) ) {\n\t\t\t\t\tvar focusableElements = Array.from( getFocusableElements( manager.element ) );\n\t\t\t\t\tfocusableElements = focusableElements.filter( function( maybeFocusable ) { return ! maybeFocusable.matches( manager.settings.closeButtonSelector ); } );\n\n\t\t\t\t\tif ( focusableElements.length > 0 ) {\n\t\t\t\t\t\tfocusElement = focusableElements[0];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Set focus\n\t\t\t\tfocusElement.focus();\n\t\t\t}\n\n\t\t\t// Make all other elements `inert`\n\t\t\tsetTreeSiblingsInert( manager.element, true );\n\t\t} );\n\t}\n\n\n\t\n\t/**\n\t * Close element\n\t */\n\t_publicMethods.close = function ( element ) {   \n\t\tvar manager = _publicMethods.getInstance( element );\n\t\t// Bail if manager invalid\n\t\tif ( ! manager ) return false;\n\n\t\t// Play closing animation then set element closed\n\t\tAnimateHelper.animateThenDo( element, manager.settings.closeAnimationClass, function() {\n\t\t\t// Set manager state\n\t\t\tmanager.state = _states.CLOSED;\n\n\t\t\t// Remove classes\n\t\t\tmanager.element.classList.remove( manager.settings.isOpenClass );\n\t\t\tdocument.body.classList.remove( manager.settings.bodyHasFlyoutOpenClass + '-' + manager.element.id );\n\n\t\t\t// Remove flyout content `role` attribute\n\t\t\tmanager.contentElement.removeAttribute( 'role' );\n\n\t\t\t// Set content element as not-focusable\n\t\t\tmanager.contentElement.removeAttribute( 'tabindex' );\n\n\t\t\t// Maybe set `hidden` attribute again\n\t\t\tif ( manager.wasHidden ) {\n\t\t\t\tmanager.element.setAttribute( 'hidden', '' );\n\t\t\t}\n\t\t\tmanager.element.wasHidden = undefined;\n\n\t\t\t// Maybe remove body class for open elements\n\t\t\tif ( ! _publicMethods.hasAnyElementOpen() ) {\n\t\t\t\tdocument.body.classList.remove( manager.settings.bodyHasFlyoutOpenClass );\n\t\t\t}\n\n\t\t\t// Release all other elements, set `inert` to false\n\t\t\tsetTreeSiblingsInert( manager.element, false );\n\n\t\t\t// Set focus back to the element previously with focus\n\t\t\tif ( manager.previousActiveElement ) {\n\t\t\t\tmanager.previousActiveElement.focus();\n\t\t\t}\n\t\t} );\n\t}\n\n\n\n\t/**\n\t * Close all instances\n\t */\n\t_publicMethods.closeAll = function () {\n\t\tfor ( var i = 0; i < _publicMethods.managers.length; i++ ) {\n\t\t\tvar manager = _publicMethods.managers[i];\n\t\t\tvar currentState = _publicMethods.getState( manager.element );\n\t\t\tif ( currentState != _states.CLOSED ) {\n\t\t\t\t_publicMethods.close( manager.element );\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Toggle element state\n\t */\n\t_publicMethods.toggle = function ( element ) {\n\t\tvar currentState = _publicMethods.getState( element );\n\t\tif ( currentState == _states.CLOSED ) {\n\t\t\t_publicMethods.open( element );\n\t\t}\n\t\telse {\n\t\t\t_publicMethods.close( element );\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Get manager instance for element\n\t */\n\t_publicMethods.getInstance = function ( element ) {\n\t\tvar instance;\n\t\tfor ( var i = 0; i < _publicMethods.managers.length; i++ ) {\n\t\t\tvar manager = _publicMethods.managers[i];\n\t\t\tif ( manager.element == element ) { instance = manager; break; }\n\t\t}\n\t\treturn instance;\n\t}\n\t\n\n\n\t/**\n\t * Get manager instance for element\n\t */\n\t_publicMethods.hasAnyElementOpen = function () {\n\t\tfor ( var i = 0; i < _publicMethods.managers.length; i++ ) {\n\t\t\tvar manager = _publicMethods.managers[i];\n\t\t\tif ( manager.state == _states.OPEN ) { return true; }\n\t\t}\n\t\t\n\t\treturn false;\n\t}\n\n\n\n\t/**\n\t * Initialize a trigger element.\n\t */\n\t_publicMethods.initializeTrigger = function( trigger ) {\n\t\t// Enable the trigger element\n\t\ttrigger.removeAttribute( 'disabled' );\n\t\ttrigger.removeAttribute( 'aria-hidden' );\n\t\t\n\t\t// Add the element to the natural tab order\n\t\ttrigger.setAttribute( 'tabindex', '0' );\n\n\t\t// Set trigger role to `button`\n\t\tif ( trigger.tagName.toUpperCase() != 'BUTTON' ) {\n\t\t\ttrigger.setAttribute( 'role', 'button' );\n\t\t}\n\n\t\t// Maybe move selector to the target attribute\n\t\tvar triggerHref = trigger.getAttribute( 'href' );\n\t\tif ( triggerHref != undefined && triggerHref != '' && triggerHref != '#' && triggerHref.indexOf( '#' ) == 0 ) {\n\t\t\t// Move selector to the target attribute\n\t\t\tvar targetElement = document.querySelector( triggerHref );\n\t\t\tif ( targetElement ) {\n\t\t\t\ttrigger.setAttribute( _settings.targetElementAttribute, triggerHref );\n\t\t\t}\n\t\t}\n\n\t\t// Remove the `href` attribute if the element has a flyout target\n\t\tif ( trigger.getAttribute( _settings.targetElementAttribute ) ) {\n\t\t\ttrigger.removeAttribute( 'href' );\n\t\t}\n\t}\n\n\t/**\n\t * Initialize Script.\n\t */\n\t_publicMethods.initTriggers = function() {\n\t\t// Iterate trigger elements\n\t\tvar triggers = document.querySelectorAll( _settings.triggerSelectors );\n\t\tfor ( var i = 0; i < triggers.length; i++ ) {\n\t\t\t_publicMethods.initializeTrigger( triggers[ i ] );\n\t\t}\n\t}\n\t\n\n\n\t/**\n\t * Initialize an element\n\t */\n\t_publicMethods.initializeElement = function( element ) {\n\t\tvar manager = {};\n\t\tmanager.element = element;\n\t\tmanager.settings = extend( _settings );\n\t\tmanager.state = _states.CLOSED;\n\n\t\t// Maybe create element ID\n\t\tif ( ! manager.element.id || manager.element.id == '' ) {\n\t\t\tmanager.element.id = manager.settings.idPrefix + '-' + _publicMethods.managers.length;\n\t\t}\n\n\t\t// Get the content element\n\t\tmanager.contentElement = manager.element.querySelector( manager.settings.flyoutContentSelector );\n\t\t\n\t\t// Try get open/close animation classes from attributes\n\t\tvar openAnimationAttrValue = manager.element.getAttribute( manager.settings.openAnimationClassAttribute );\n\t\tvar closeAnimationAttrValue = manager.element.getAttribute( manager.settings.closeAnimationClassAttribute );\n\t\tmanager.settings.openAnimationClass = openAnimationAttrValue && openAnimationAttrValue != '' ? openAnimationAttrValue : _settings.openAnimationClass;\n\t\tmanager.settings.closeAnimationClass = closeAnimationAttrValue && closeAnimationAttrValue != '' ? closeAnimationAttrValue : _settings.closeAnimationClass;\n\n\t\t// Set flyout accessible name\n\t\tvar ariaLabelValue = manager.element.getAttribute( 'aria-label' );\n\t\tvar ariaLabelledbyValue = manager.element.getAttribute( 'aria-labelledby' );\n\t\tif ( ( ! ariaLabelValue || ariaLabelValue == '' ) && ( ! ariaLabelledbyValue || ariaLabelledbyValue == '' ) ) {\n\t\t\tvar firstHeading = manager.contentElement.querySelector( manager.settings.headingsSelector );\n\t\t\t\n\t\t\t// Set `aria-labelled` If a heading element exists inside the flyout content element\n\t\t\tif ( firstHeading ) {\n\t\t\t\tvar headingId = firstHeading.id != undefined && firstHeading.id != '' ? firstHeading.id : manager.element.id + '-heading';\n\t\t\t\tfirstHeading.id = headingId;\n\t\t\t\tmanager.contentElement.setAttribute( 'aria-labelledby', headingId );\n\t\t\t}\n\t\t}\n\n\t\t// Set flyout accessible description\n\t\tvar ariaDescribedbyValue = manager.element.getAttribute( 'aria-describedby' );\n\t\tif ( ! ariaDescribedbyValue || ariaDescribedbyValue == '' ) {\n\t\t\tvar descriptionElement = manager.contentElement.querySelector( '[' + manager.settings.descriptionAttribute + ']' );\n\t\t\t\n\t\t\t// If a description element exists inside the flyout content element\n\t\t\tif ( descriptionElement ) {\n\t\t\t\tvar descriptionId = descriptionElement.id != undefined && descriptionElement.id != '' ? descriptionElement.id : manager.element.id + '-description';\n\t\t\t\tdescriptionElement.id = descriptionId;\n\t\t\t\tmanager.contentElement.setAttribute( 'aria-describedby', descriptionId );\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Set element as activated\n\t\tmanager.isActivated = true;\n\t\tmanager.element.classList.add( manager.settings.isActivatedClass );\n\t\t\n\t\t// Add manager to public methods\n\t\t_publicMethods.managers.push( manager );\n\t}\n\n\n\n\t/**\n\t * Finish Initialize\n\t */\n\tvar finishInit = function( options ) {\n\t\t// Merge with general settings with options\n\t\t_settings = extend( _defaults, options );\n\n\t\t// Set dynamic settings value\n\t\t_settings.triggerSelectors = _settings.toggleButtonSelector + ', ' + _settings.openButtonSelector + ', ' + _settings.closeButtonSelector;\n\n\t\t// Iterate elements\n\t\tvar elements = document.querySelectorAll( _settings.flyoutWrapperSelector );\n\t\tfor ( var i = 0; i < elements.length; i++ ) {\n\t\t\t_publicMethods.initializeElement( elements[ i ] );\n\t\t}\n\n\t\t// Iterate trigger elements\n\t\t_publicMethods.initTriggers();\n\n\t\t// Add flyout overlay\n\t\tvar overlayElement = document.createElement('div');\n\t\toverlayElement.innerHTML = _settings.overlayTemplate.trim();\n\t\tdocument.body.appendChild( overlayElement.childNodes[0] );\n\n\t\t// Add event listeners\n\t\tdocument.addEventListener( 'click', handleClick );\n\t\tdocument.addEventListener( 'keydown', handleKeyDown, true );\n\t\t\n\t\t// Add body class\n\t\tdocument.body.classList.add( _settings.bodyHasFlyoutClass );\n\n\t\t_hasInitialized = true;\n\t}\n\n\t\n\n\t/**\n\t * Initialize Script.\n\t */\n\t_publicMethods.init = function( options ) {\n\t\tif ( _hasInitialized ) return;\n\n\t\t// Maybe finish initialization\n\t\tif ( window.AnimateHelper && ( HTMLElement.prototype.hasOwnProperty('inert') || Element.prototype.hasOwnProperty( 'inert' ) ) ) {\n\t\t\tfinishInit( options );\n\t\t}\n\t\telse {\n\t\t\tconsole.log( 'FlyoutBlock could not be initialized.' );\n\t\t\tconsole.log( 'AnimateHelper loaded: ' + !! window.AnimateHelper );\n\t\t\tconsole.log( 'HTMLElement has `inert` property: ' + !! HTMLElement.prototype.hasOwnProperty('inert') );\n\t\t\tconsole.log( 'Element has `inert` property: ' + !! Element.prototype.hasOwnProperty('inert') );\n\t\t}\n\t};\n\n\n\n\t//\n\t// Public APIs\n\t//\n\treturn _publicMethods;\n\n});\n"],"names":["root","factory","define","amd","exports","module","FlyoutBlock","global","this","window","extend","extended","deep","i","Object","prototype","toString","call","arguments","length","prop","obj","hasOwnProperty","handleKeyDown","e","defaultPrevented","key","_key","ESC","_publicMethods","closeAll","ENTER","SPACE","target","closest","_settings","triggerSelectors","handleClick","setTreeSiblingsInert","element","inert","parentNode","targetElement","setSiblingsInert","siblings","childNodes","Array","from","forEach","child","_hasInitialized","managers","_defaults","flyoutWrapperSelector","flyoutContentSelector","toggleButtonSelector","openButtonSelector","closeButtonSelector","overlaySelector","flyoutTogglePassActionSelector","autoFocusSelector","flyoutToggleClassSelector","flyoutClassTogglePrefix","idPrefix","headingsSelector","bodyHasFlyoutClass","bodyHasFlyoutOpenClass","isActivatedClass","isOpenClass","openAnimationClass","closeAnimationClass","targetElementAttribute","openAnimationClassAttribute","closeAnimationClassAttribute","manualFocusAttribute","descriptionAttribute","autoFocusAttribute","focusableElementsSelector","flyoutRoleAttribute","overlayTemplate","_states","TAB","getTargetElement","targetSelector","getAttribute","document","querySelector","getTargetElementFromClass","classList","cssClass","indexOf","replace","toggleElement","button","preventDefault","toggle","open","close","matches","getState","manager","getInstance","state","previousActiveElement","activeElement","AnimateHelper","doThenAnimate","settings","wasHidden","hasAttribute","removeAttribute","add","body","id","focusableElements","roleAttrValue","contentElement","setAttribute","focusElement","autofocusChild","querySelectorAll","filter","maybeFocusable","focus","animateThenDo","remove","undefined","hasAnyElementOpen","instance","initializeTrigger","trigger","tagName","toUpperCase","triggerHref","initTriggers","triggers","initializeElement","openAnimationAttrValue","closeAnimationAttrValue","ariaLabelValue","ariaLabelledbyValue","ariaDescribedbyValue","firstHeading","headingId","descriptionElement","descriptionId","isActivated","push","init","options","HTMLElement","Element","elements","overlayElement","createElement","innerHTML","trim","appendChild","addEventListener","console","log"],"mappings":"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"}